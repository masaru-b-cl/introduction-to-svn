[↑目次](README.md "目次") | [← 13章 チームでの利用 - 作業ベース](13.team-use-1.md "チームでの利用 - 作業ベース")

# チームでの利用 - 競合

チームで作業を進めていく上で、メンバー間の協調作業は欠かせません。そのため、事前に作業範囲が重ならないように調整することが大事です。

しかし、どうしても同じ場所に同時に変更を加える必要も出てきます。そんなときはメンバー間の作業が「競合」してしまうことがあります。本章ではそんな時にどのように対処すればよいのか説明します。

1. [競合とは？](#what-is-conflict)
1. [競合の発生](#occuring-conflict)
1. [競合の編集](#edit-conflict)
1. [競合の解決](#resolve-conflict)

## <a name="what-is-conflict"></a>1. 競合とは？

「競合」とは二人以上の作業者（過去の自分を含む）の作業範囲が重なってしまい、VCSが成果物の「最新」状態を自動的に推測することができなくなった状態を指します。SVNでの発生タイミングは、前章で紹介した「更新」のタイミング、そして[12章](12.tag-and-branch-5.md)で紹介したような別リビジョンの成果を「マージ」するタイミングです。

![「競合」の発生タイミング](images/chapter-14-1.jpg)

図14-1 「競合」の発生タイミング

競合が発生した場合、その後行う対処には次の3通りがあり、競合先ファイルの作業者をログ等で確認の上、関係者と調整してどの方法を選ぶか決定します。

* 競合先のバージョンを採用する
* 自分のバージョンを採用する
* 競合を編集する

### 競合先のバージョンを採用する

そのファイルの最新リビジョンを正とする方法です。この方法を選択した場合、自分が行った作業の成果は失われます。

### 自分のバージョンを採用する

手元のファイルを正とする方法です。この方法を選択した場合、最新リビジョンの成果は上書きされます。

### 競合を編集する

最新リビジョンの内容を元に、自分の作業の成果の一部を反映させる方法で、３つの対応方法の中では最も最初に検討すべき法です。しかし、対象成果物についてよく知っていて、どのように直せばよいか知っている必要が有るため、最もスキルが問われる方法でもあります。

そして、競合への対応が終わった後は、「競合の解決」を行い競合が解消されたことをSVNに通知し、成果物を「コミット」する必要があります。

それでは、今回は「更新」により競合を発生させ、「競合の編集」を行い、「競合を解決」する方法をシミュレーションしてみましょう。前章で作成したリポジトリ、及び作業コピーを引き続き使用します。

## <a name="occuring-conflict"></a>2. 競合の発生

まず、競合の動きがよく分かるように、以下の様な数値を並べたnumbers.txtファイルをperson1の作業コピー上に作成して、追加、コミットします。その後、person2で更新を行い、numberx.txtを取得しておきます。

    10
    20
    30
    40
    50
    60
    70

次に、person1作業コピーにて、numbers.txtに①15を追加、②40を43に変更、③60を削除してコミットします。編集後のファイルは次のようになります。

    10
    15
    20
    30
    43
    50
    70

続いて、person2作業コピーにて、更新をせずにnumbers.txtに①25を追加、②40を47に変更、③70を削除します。編集後のファイルは次のようになります。

    10
    20
    25
    30
    47
    50
    60

このまま、person2作業コピーでコミットを行うと、次のようにコミット失敗を知らせるダイアログが表示されます。

![コミット 失敗](images/chapter-14-2.jpg)

図14-2 コミット 失敗

エラー内容を見ると、コミットしようとしたファイルが「リポジトリ側と比べて古くなっています」となっています。これは少しわかりにくいですが、つまりは他の作業者によって先にコミットが行われたことを表しています。

そして、更にエラーメッセージを見ていくと、「更新」を促されていることがわかります。このまま「OK」ボタンをクリックすると、「更新」を行うためのダイアログが表示されるので、「更新」をクリックして更新を行います。

![更新選択ダイアログ](images/chapter-14-3.jpg)

図14-3 更新選択ダイアログ

すると今度は「競合」が発生して「更新」に失敗します。

![競合発生](images/chapter-14-4.jpg)

図14-4 競合発生

「OK」ボタンをクリックすると、再びコミットダイアログが表示されます。

![競合発生](images/chapter-14-5.jpg)

図14-5 競合発生


## <a name="edit-conflict"></a>3. 競合の編集

1. 競合発生時に作成されたファイルの説明
    1. 競合発生ファイル
        1. 競合発生箇所の説明
    1. *.rNファイル2種
    1. *.mineファイル
1. 対応方法それぞれの場合の対処方法
    * 競合先のバージョンを採用する
    * 自分のバージョンを採用する
    * 競合を編集する
1. 競合の編集
    * マージツールで

## <a name="resolve-conflict"></a>4. 競合の解決

1. 競合の解決
    * コンテキストメニュー
    * 競合のダイアログから
    * ツールから
2. コミット
    * 結果確認


----------

<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.ja"><img alt="クリエイティブ・コモンズ・ライセンス" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" /></a>
